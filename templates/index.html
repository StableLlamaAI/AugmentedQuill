{% extends "base.html" %}
{% block title %}AugmentedQuill — Prototype{% endblock %}
{% block content %}
  <div class="aq-shell" data-component="shell-view">
    <aside class="aq-sidebar">
      <div class="aq-sidebar-top">
        <h3 class="aq-sidebar-title">Chapters</h3>
        <ul class="aq-chapters" data-chapter-list>
          <li class="aq-empty">No chapters configured</li>
        </ul>
        <div style="padding: 0.5rem 0.5rem 0;">
          <button class="aq-btn" style="width:100%;" data-action="create-chapter">+ New chapter</button>
        </div>
      </div>
      <div class="aq-sidebar-bottom">
        <button class="aq-btn aq-btn-primary" hx-get="/settings" hx-target="#main" hx-swap="innerHTML">Settings</button>
      </div>
    </aside>

    <section id="main" class="aq-mainpane">
      <div class="aq-panel">
        <div class="aq-toolbar" style="gap:0.5rem; align-items:center;">
          <button id="save" class="aq-btn aq-btn-primary" data-action="save">Save</button>
          <span data-dirty-indicator style="font-size:0.9rem; color:var(--accent); margin-left:0.5rem; display:none;">Unsaved changes</span>
          <div style="margin-left:auto; display:flex; gap:0.5rem; align-items:center;">
            <span style="font-size:0.9rem; color:var(--muted);">Width:</span>
            <button class="aq-btn" data-action="change-width" data-direction="decrease">Narrower</button>
            <button class="aq-btn" data-action="change-width" data-direction="increase">Wider</button>
            <span style="font-size:0.9rem; color:var(--muted); margin-left: 0.5rem;">Editor:</span>
            <button class="aq-btn" data-mode="raw">Raw</button>
            <button class="aq-btn" data-mode="markdown">Markdown</button>
            <button class="aq-btn" data-mode="wysiwyg">WYSIWYG</button>
          </div>
        </div>
        <div class="aq-content">
          <div class="aq-card">
            <div data-view="empty">
              <div class="aq-empty">Select a chapter to view its content.</div>
            </div>
            <div data-view="chapter" style="display:none;">
              <div style="font-weight:600; margin-bottom:0.5rem;">Chapter <span data-active-id></span></div>
              <div data-raw-toolbar class="aq-toolbar" style="gap:0.25rem; flex-wrap:wrap; margin-bottom:0.5rem;">
                <button class="aq-btn aq-btn-sm" title="Bold" data-action="wrap-selection" data-before="**" data-after="**"><strong>B</strong></button>
                <button class="aq-btn aq-btn-sm" title="Italic" data-action="wrap-selection" data-before="*" data-after="*"><em>I</em></button>
                <button class="aq-btn aq-btn-sm" title="Heading" data-action="insert-heading">H1</button>
                <button class="aq-btn aq-btn-sm" title="Link" data-action="insert-link">Link</button>
                <button class="aq-btn aq-btn-sm" title="Code" data-action="wrap-selection" data-before="`" data-after="`">Code</button>
                <button class="aq-btn aq-btn-sm" title="Bullet list" data-action="toggle-list" data-prefix="- ">• List</button>
                <button class="aq-btn aq-btn-sm" title="Quote" data-action="toggle-prefix" data-prefix="> ">❝ Quote</button>
              </div>
              <textarea data-ref="rawEditor"></textarea>
            </div>
          </div>
          <p class="aq-tip">This is a rudimentary UI. Use the Settings button in the sidebar to configure machine and story settings.</p>
        </div>
      </div>
    </section>

    <!-- Right sidebar: Chat -->
    <aside class="aq-rightbar">
      <div class="aq-rightbar-top" data-component="chat-view">
        <h3 class="aq-sidebar-title">Chat</h3>
        <div class="aq-field" style="margin-top:0.25rem;">
          <label>
            <span style="display:block; font-size:0.85rem; color:var(--muted); margin-bottom:0.25rem;">Model</span>
            <select data-ref="modelSelect"></select>
          </label>
        </div>
        <div class="aq-chat" data-ref="chatList">
          <div class="aq-empty">No messages</div>
        </div>
        <div class="aq-chat-input">
          <div class="aq-field" style="margin:0;">
            <div class="aq-chat-input-row">
              <div class="aq-role-select">
                <button class="aq-btn aq-btn-sm" data-ref="roleButton" aria-haspopup="listbox" aria-expanded="false">user ▾</button>
                <div class="aq-role-menu" data-ref="roleMenu" hidden>
                  <button type="button" data-role="system">system</button>
                  <button type="button" data-role="assistant">assistant</button>
                  <button type="button" data-role="user">user</button>
                </div>
              </div>
              <textarea rows="3" placeholder="Type a message..." data-ref="input"></textarea>
            </div>
          </div>
          <div class="aq-toolbar" style="justify-content: flex-end; margin-top:0.5rem;">
            <button class="aq-btn" data-ref="deleteLast">Delete last</button>
            <button class="aq-btn aq-btn-primary" data-ref="send">Send</button>
            <button class="aq-btn" data-ref="regenerate">Regenerate</button>
          </div>
        </div>
      </div>
    </aside>
  </div>
{% endblock %}
