name: Create Release (manual)

on:
  workflow_dispatch:
    branches: [ "main" ]
    inputs:
      version:
        description: 'New release version (tag), e.g. v1.2.3'
        required: true
        type: string
      body:
        description: 'Release notes / body'
        required: false
        type: string

permissions:
  contents: write

jobs:
  create-release:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure workflow is running on `main`
        run: |
          if [ "${GITHUB_REF#refs/heads/}" != "main" ]; then
            echo "This workflow can only be run on the main branch.";
            exit 1;
          fi

      - name: Ensure RELEASE_TOKEN secret is provided
        run: |
          if [ -z "${{ secrets.RELEASE_TOKEN }}" ]; then
            echo "Secret RELEASE_TOKEN is not set. This workflow requires a personal access token (repo scope) in the repo secrets named RELEASE_TOKEN.";
            echo "Create a PAT with 'repo' scope and add it at Settings → Secrets → Actions → New repository secret.";
            exit 1;
          fi

      - name: Create GitHub Release (action)
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ github.event.inputs.version }}
          name: ${{ github.event.inputs.version }}
          body: ${{ github.event.inputs.body }}
          draft: false
          prerelease: false
          commit: main
          token: ${{ secrets.RELEASE_TOKEN }}
